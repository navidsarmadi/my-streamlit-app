import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import random
from datetime import datetime, timedelta

# ุชูุธูุงุช ุตูุญู
st.set_page_config(page_title="ุดุจูโุณุงุฒ ุฌุงูุดูโูพุฑูุฑ ุจุงูฺฉ", layout="wide")


class BankSuccessionSimulator:
    def __init__(self):
        # ุธุฑูุชโูุง ูพุดโูุฑุถ ูุฎุชูู ุดุนุจ
        self.default_capacity = {
            'ุฑุฆุณ_ุดุนุจู': {'ุฏุฑุฌู4': 240, 'ุฏุฑุฌู3': 720, 'ุฏุฑุฌู2': 230, 'ุฏุฑุฌู1': 100, 'ููุชุงุฒ': 180},
            'ูุนุงูู_ุดุนุจู': {'ุฏุฑุฌู4': 240, 'ุฏุฑุฌู3': 720, 'ุฏุฑุฌู2': 230, 'ุฏุฑุฌู1': 100, 'ููุชุงุฒ': 360},
            'ุฑุฆุณ_ุตูุฏูู': {'ุฏุฑุฌู4': 240, 'ุฏุฑุฌู3': 720, 'ุฏุฑุฌู2': 230, 'ุฏุฑุฌู1': 100, 'ููุชุงุฒ': 180},
            'ุฑุฆุณ_ุงุนุชุจุงุฑุงุช': {'ุฏุฑุฌู4': 240, 'ุฏุฑุฌู3': 720, 'ุฏุฑุฌู2': 230, 'ุฏุฑุฌู1': 100, 'ููุชุงุฒ': 80},
            'ุจุงูฺฉุฏุงุฑ': {'ุฏุฑุฌู4': 960, 'ุฏุฑุฌู3': 2880, 'ุฏุฑุฌู2': 1380, 'ุฏุฑุฌู1': 600, 'ููุชุงุฒ': 1800},
            'ูุนุงูู_ูุฏุฑ_ุดุนุจ': 105,
            'ูุฏุฑ_ุดุนุจ': 35
        }

        # ุงุญุชูุงูุงุช ุงูุชูุงู ูพุดโูุฑุถ
        self.default_probabilities = {
            'ุจุงูฺฉุฏุงุฑ_to_ุฑุฆุณ_ุฏุงุฑู4': 0.6,
            'ุฑุฆุณ_ุฏุงุฑู4_to_ุฑุฆุณ_ุฏุงุฑู_ููุชุงุฒ': 0.7,
            'ุฑุฆุณ_ุฏุงุฑู4_to_ูุนุงูู_ุดุนุจู4': 0.3,
            'ูุนุงูู_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู4': 0.5,
            'ูุนุงูู_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู3': 0.2,
            'ูุนุงูู_ุดุนุจู4_to_ูุนุงูู_ุดุนุจู3': 0.3,
            'ุฑุฆุณ_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู3': 0.5,
            'ุฑุฆุณ_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู2': 0.2,
            'ุฑุฆุณ_ุดุนุจู4_to_ูุนุงูู_ุดุนุจู2': 0.3,
            'ุฑุฆุณ_ุดุนุจู3_to_ุฑุฆุณ_ุดุนุจู2': 0.4,
            'ุฑุฆุณ_ุดุนุจู3_to_ุฑุฆุณ_ุดุนุจู1': 0.1,
            'ุฑุฆุณ_ุดุนุจู3_to_ูุนุงูู_ุดุนุจู1': 0.1,
            'ุฑุฆุณ_ุดุนุจู3_retire': 0.4,
            'ุฑุฆุณ_ุดุนุจู2_to_ุฑุฆุณ_ุดุนุจู1': 0.4,
            'ุฑุฆุณ_ุดุนุจู2_to_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ': 0.1,
            'ุฑุฆุณ_ุดุนุจู2_to_ูุนุงูู_ุดุนุจู_ููุชุงุฒ': 0.1,
            'ุฑุฆุณ_ุดุนุจู2_retire': 0.4,
            'ุฑุฆุณ_ุดุนุจู1_to_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ': 0.5,
            'ุฑุฆุณ_ุดุนุจู1_to_ูุนุงูู_ูุฏุฑ': 0.1,
            'ุฑุฆุณ_ุดุนุจู1_to_ูุฏุฑ_ุดุนุจ': 0.1,
            'ุฑุฆุณ_ุดุนุจู1_retire': 0.3,
            'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_to_ูุนุงูู_ูุฏุฑ': 0.2,
            'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_to_ูุฏุฑ_ุดุนุจ': 0.1,
            'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_retire': 0.4,
            'ูุนุงูู_ูุฏุฑ_to_ูุฏุฑ_ุดุนุจ': 0.3,
            'ูุนุงูู_ูุฏุฑ_retire': 0.7
        }

        # ุณุงูโูุง ูพุดโูุฑุถ ููุฑุฏ ูุงุฒ ุจุฑุง ุงูุชูุงู
        self.default_years_required = {
            'ุจุงูฺฉุฏุงุฑ_to_ุฑุฆุณ_ุฏุงุฑู4': 3,
            'ุฑุฆุณ_ุฏุงุฑู4_to_ุฑุฆุณ_ุฏุงุฑู_ููุชุงุฒ': 2,
            'ุฑุฆุณ_ุฏุงุฑู4_to_ูุนุงูู_ุดุนุจู4': 2,
            'ูุนุงูู_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู4': 3,
            'ูุนุงูู_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู3': 4,
            'ูุนุงูู_ุดุนุจู4_to_ูุนุงูู_ุดุนุจู3': 2,
            'ุฑุฆุณ_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู3': 3,
            'ุฑุฆุณ_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู2': 5,
            'ุฑุฆุณ_ุดุนุจู4_to_ูุนุงูู_ุดุนุจู2': 4,
            'ุฑุฆุณ_ุดุนุจู3_to_ุฑุฆุณ_ุดุนุจู2': 3,
            'ุฑุฆุณ_ุดุนุจู3_to_ุฑุฆุณ_ุดุนุจู1': 5,
            'ุฑุฆุณ_ุดุนุจู3_to_ูุนุงูู_ุดุนุจู1': 4,
            'ุฑุฆุณ_ุดุนุจู2_to_ุฑุฆุณ_ุดุนุจู1': 3,
            'ุฑุฆุณ_ุดุนุจู2_to_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ': 4,
            'ุฑุฆุณ_ุดุนุจู2_to_ูุนุงูู_ุดุนุจู_ููุชุงุฒ': 3,
            'ุฑุฆุณ_ุดุนุจู1_to_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ': 4,
            'ุฑุฆุณ_ุดุนุจู1_to_ูุนุงูู_ูุฏุฑ': 5,
            'ุฑุฆุณ_ุดุนุจู1_to_ูุฏุฑ_ุดุนุจ': 7,
            'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_to_ูุนุงูู_ูุฏุฑ': 4,
            'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_to_ูุฏุฑ_ุดุนุจ': 6,
            'ูุนุงูู_ูุฏุฑ_to_ูุฏุฑ_ุดุนุจ': 3
        }

        # ุขูุงุฑ ุจุงุฒูุดุณุชฺฏ
        self.retirement_stats = {
            '5_years': 0.5,
            '10_years': 0.8,
            '15_years': 1.0
        }

    def create_capacity_settings(self):
        """ุงุฌุงุฏ ุชูุธูุงุช ุธุฑูุช ููุงุตุจ"""
        st.sidebar.header("๐ข ุชูุธู ุธุฑูุช ููุงุตุจ")

        capacity = {}

        # ููุงุตุจ ูุฎุชูู
        position_groups = {
            "ุฑุฆุณ ุดุนุจู": ['ุฏุฑุฌู4', 'ุฏุฑุฌู3', 'ุฏุฑุฌู2', 'ุฏุฑุฌู1', 'ููุชุงุฒ'],
            "ูุนุงูู ุดุนุจู": ['ุฏุฑุฌู4', 'ุฏุฑุฌู3', 'ุฏุฑุฌู2', 'ุฏุฑุฌู1', 'ููุชุงุฒ'],
            "ุณุงุฑ ููุงุตุจ": ['ูุนุงูู_ูุฏุฑ_ุดุนุจ', 'ูุฏุฑ_ุดุนุจ']
        }

        with st.sidebar.expander("ุชูุธู ุธุฑูุชโูุง"):
            for group_name, items in position_groups.items():
                st.markdown(f"**{group_name}**")
                if group_name == "ุณุงุฑ ููุงุตุจ":
                    for item in items:
                        default_val = self.default_capacity.get(item, 50)
                        persian_name = item.replace('_', ' ')
                        capacity[item] = st.number_input(
                            persian_name,
                            min_value=1,
                            max_value=1000,
                            value=default_val,
                            key=f"capacity_{item}"
                        )
                else:
                    position_key = group_name.replace(' ', '_').lower()
                    capacity[position_key] = {}
                    for grade in items:
                        default_val = self.default_capacity.get(position_key, {}).get(grade, 100)
                        capacity[position_key][grade] = st.number_input(
                            f"{grade}",
                            min_value=1,
                            max_value=5000,
                            value=default_val,
                            key=f"capacity_{position_key}_{grade}"
                        )

        return capacity

    def create_probability_sliders(self):
        """ุงุฌุงุฏ ุงุณูุงุฏุฑูุง ุจุฑุง ุชุบุฑ ุงุญุชูุงูุงุช ู ุณุงูโูุง ููุฑุฏ ูุงุฒ"""
        st.sidebar.header("โ๏ธ ุชูุธู ุงุญุชูุงูุงุช ู ุฒูุงูโุจูุฏ")

        probabilities = {}
        years_required = {}

        # ฺฏุฑููโุจูุฏ ุงุญุชูุงูุงุช ุจุฑุง ููุงุด ุจูุชุฑ
        groups = {
            "ุจุงูฺฉุฏุงุฑ ู ุฑุฆุณ ุฏุงุฑู": [
                'ุจุงูฺฉุฏุงุฑ_to_ุฑุฆุณ_ุฏุงุฑู4',
                'ุฑุฆุณ_ุฏุงุฑู4_to_ุฑุฆุณ_ุฏุงุฑู_ููุชุงุฒ',
                'ุฑุฆุณ_ุฏุงุฑู4_to_ูุนุงูู_ุดุนุจู4'
            ],
            "ูุนุงูู ุดุนุจู ุฏุฑุฌู 4": [
                'ูุนุงูู_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู4',
                'ูุนุงูู_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู3',
                'ูุนุงูู_ุดุนุจู4_to_ูุนุงูู_ุดุนุจู3'
            ],
            "ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 4": [
                'ุฑุฆุณ_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู3',
                'ุฑุฆุณ_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู2',
                'ุฑุฆุณ_ุดุนุจู4_to_ูุนุงูู_ุดุนุจู2'
            ],
            "ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 3": [
                'ุฑุฆุณ_ุดุนุจู3_to_ุฑุฆุณ_ุดุนุจู2',
                'ุฑุฆุณ_ุดุนุจู3_to_ุฑุฆุณ_ุดุนุจู1',
                'ุฑุฆุณ_ุดุนุจู3_to_ูุนุงูู_ุดุนุจู1',
                'ุฑุฆุณ_ุดุนุจู3_retire'
            ],
            "ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 2": [
                'ุฑุฆุณ_ุดุนุจู2_to_ุฑุฆุณ_ุดุนุจู1',
                'ุฑุฆุณ_ุดุนุจู2_to_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ',
                'ุฑุฆุณ_ุดุนุจู2_to_ูุนุงูู_ุดุนุจู_ููุชุงุฒ',
                'ุฑุฆุณ_ุดุนุจู2_retire'
            ],
            "ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 1": [
                'ุฑุฆุณ_ุดุนุจู1_to_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ',
                'ุฑุฆุณ_ุดุนุจู1_to_ูุนุงูู_ูุฏุฑ',
                'ุฑุฆุณ_ุดุนุจู1_to_ูุฏุฑ_ุดุนุจ',
                'ุฑุฆุณ_ุดุนุจู1_retire'
            ],
            "ุฑุฆุณ ุดุนุจู ููุชุงุฒ": [
                'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_to_ูุนุงูู_ูุฏุฑ',
                'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_to_ูุฏุฑ_ุดุนุจ',
                'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_retire'
            ],
            "ูุนุงูู ูุฏุฑ ุดุนุจ": [
                'ูุนุงูู_ูุฏุฑ_to_ูุฏุฑ_ุดุนุจ',
                'ูุนุงูู_ูุฏุฑ_retire'
            ]
        }

        for group_name, keys in groups.items():
            with st.sidebar.expander(f"๐ {group_name}"):
                for key in keys:
                    if key in self.default_probabilities:
                        persian_label = key.replace('_', ' โ ').replace('to', 'ุจู').replace('retire', 'ุจุงุฒูุดุณุชฺฏ')

                        col1, col2 = st.columns(2)

                        with col1:
                            st.markdown(f"**{persian_label}**")
                            probabilities[key] = st.slider(
                                "ุงุญุชูุงู",
                                0.0, 1.0,
                                self.default_probabilities[key],
                                0.01,
                                key=f"prob_{key}"
                            )

                        with col2:
                            st.markdown("**ุณุงูโูุง ูุงุฒู**")
                            if 'retire' not in key:  # ุจุงุฒูุดุณุชฺฏ ูุงุฒ ุจู ุณุงู ูุฏุงุฑุฏ
                                years_required[key] = st.number_input(
                                    "ุณุงู",
                                    1, 10,
                                    self.default_years_required.get(key, 3),
                                    key=f"years_{key}"
                                )
                            else:
                                years_required[key] = 0  # ุจุงุฒูุดุณุชฺฏ ููุฑ

        return probabilities, years_required

    def create_simulation_explanation(self):
        """ุงุฌุงุฏ ูุณูุช ุชูุถุญุงุช ุดุจูโุณุงุฒ"""
        st.header("๐ ุฑุงูููุง ุดุจูโุณุงุฒ ุฌุงูุดูโูพุฑูุฑ ุจุงูฺฉ")

        with st.expander("๐ ุชูุถุญ ฺฉุงูู ุดุจูโุณุงุฒ - ุจุฑุง ุชุงุฒูโฺฉุงุฑุงู"):
            st.markdown("""
            ### ๐ฏ ูุฏู ุงู ุดุจูโุณุงุฒ:
            ุงู ุงุจุฒุงุฑ ุจุฑุง ูพุดโุจู ู ุชุญูู ุชุบุฑุงุช ูุฑู ุงูุณุงู ุฏุฑ ุณุงุฎุชุงุฑ ุณุงุฒูุงู ุจุงูฺฉ ุทุฑุงุญ ุดุฏู ุงุณุช.

            ### ๐๏ธ ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏ:

            #### 1๏ธโฃ **ูุฏูโุณุงุฒ ุณุงุฎุชุงุฑ ุณุงุฒูุงู:**
            - ูุฑ ุณูุช ุดุบู ุฏุงุฑุง ุธุฑูุช ูุดุฎุต ุงุณุช
            - ฺฉุงุฑฺฉูุงู ูโุชูุงููุฏ ุงุฒ ุณูุชโูุง ูพุงูโุชุฑ ุจู ุจุงูุงุชุฑ ุงุฑุชูุง ุงุจูุฏ
            - ุจุฑุฎ ฺฉุงุฑฺฉูุงู ุจุงุฒูุดุณุชู ูโุดููุฏ
            - ุงุณุชุฎุฏุงูโูุง ุฌุฏุฏ ูุนูููุงู ุฏุฑ ูพุงูโุชุฑู ุณุทูุญ ุงูุฌุงู ูโุดูุฏ

            #### 2๏ธโฃ **ูพุงุฑุงูุชุฑูุง ฺฉูุฏ:**

            **ุงูู) ุงุญุชูุงู ุงูุชูุงู:** 
            - ูุฑ ุงูุชูุงู ุดุบู ุงุญุชูุงู ูุดุฎุต ุฏุงุฑุฏ (ูุซูุงู 60% ุงุญุชูุงู ุงุฑุชูุง ุงุฒ ุจุงูฺฉุฏุงุฑ ุจู ุฑุฆุณ ุฏุงุฑู)
            - ุดูุง ูโุชูุงูุฏ ุงู ุงุญุชูุงูุงุช ุฑุง ุชุบุฑ ุฏูุฏ

            **ุจ) ุณุงูโูุง ููุฑุฏ ูุงุฒ:**
            - ุจุฑุง ูุฑ ุงุฑุชูุงุ ุญุฏุงูู ุชุนุฏุงุฏ ุณุงู ูุงุฒู ุงุณุช
            - ูุซูุงู ุจุงุฏ 3 ุณุงู ุจุงูฺฉุฏุงุฑ ุจุงุดุฏ ุชุง ุจุชูุงูุฏ ุฑุฆุณ ุฏุงุฑู ุดูุฏ

            **ุฌ) ุธุฑูุช ููุงุตุจ:**
            - ูุฑ ุณูุช ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ูุดุฎุต ฺฉุงุฑููุฏ ูโุชูุงูุฏ ุฏุงุดุชู ุจุงุดุฏ
            - ุดูุง ูโุชูุงูุฏ ุงู ุธุฑูุชโูุง ุฑุง ุชุบุฑ ุฏูุฏ

            #### 3๏ธโฃ **ูุฑุขูุฏ ุดุจูโุณุงุฒ:**

            **ุณุงู ุจู ุณุงู ุงุชูุงูุงุช ุฒุฑ ุฑุฎ ูโุฏูุฏ:**
            1. **ุงุณุชุฎุฏุงู ุฌุฏุฏ:** ุชุนุฏุงุฏ ูุดุฎุต ฺฉุงุฑููุฏ ุฌุฏุฏ (ูุนูููุงู ุจุงูฺฉุฏุงุฑ) ุงุณุชุฎุฏุงู ูโุดูุฏ
            2. **ุจุงุฒูุดุณุชฺฏ:** ุจุฎุด ุงุฒ ฺฉุงุฑฺฉูุงู (ุนูุฏุชุงู ุงุฑุดุฏุชุฑ) ุจุงุฒูุดุณุชู ูโุดููุฏ
            3. **ุงุฑุชูุงุกูุง:** ฺฉุงุฑฺฉูุงู ูุงุฌุฏ ุดุฑุงุท ุจุฑ ุงุณุงุณ ุงุญุชูุงู ู ุณุงุจูู ฺฉุงุฑ ุงุฑุชูุง ูโุงุจูุฏ
            4. **ุชูุธู ุธุฑูุช:** ุงฺฏุฑ ุชุนุฏุงุฏ ุงูุฑุงุฏ ุงุฒ ุธุฑูุช ุชุฌุงูุฒ ฺฉูุฏุ ุจุฑูุงููโุฑุฒ ูุฌุฏุฏ ุงูุฌุงู ูโุดูุฏ

            #### 4๏ธโฃ **ุฎุฑูุฌโูุง ุดุจูโุณุงุฒ:**

            **ุงูู) ูููุฏุงุฑูุง ุชุญูู:**
            - ุฑููุฏ ุชุบุฑุงุช ฺฉู ูพุฑุณูู ุฏุฑ ุทูู ุฒูุงู
            - ููุงุณู ุชูุฒุน ููุงุตุจ ุฏุฑ ุงุจุชุฏุง ู ุงูุชูุง ุฏูุฑู
            - ุฑููุฏ ุชุบุฑุงุช ูุฑ ุณูุช ุจู ุตูุฑุช ุฌุฏุงฺฏุงูู

            **ุจ) ุฌุฏุงูู ุชูุตู:**
            - ุชุนุฏุงุฏ ุงุณุชุฎุฏุงูุ ุจุงุฒูุดุณุชฺฏ ู ุงุฑุชูุง ุฏุฑ ูุฑ ุณุงู
            - ูุถุนุช ููุง ูุฑ ุณูุช

            **ุฌ) ูุดุฏุงุฑูุง ู ูพุดููุงุฏุงุช:**
            - ุชุดุฎุต ฺฉูุจูุฏ ุง ูุงุฒุงุฏ ูุฑู
            - ูพุดููุงุฏ ุฑุงูโุญูโูุง ููุงุณุจ

            ### ๐๏ธ ูุญูู ุงุณุชูุงุฏู:

            #### ฺฏุงู 1: ุชูุธู ูพุงุฑุงูุชุฑูุง ุงุตู
            - ุชุนุฏุงุฏ ุณุงูโูุง ุดุจูโุณุงุฒ (1 ุชุง 20 ุณุงู)
            - ุชุนุฏุงุฏ ุงุณุชุฎุฏุงู ุณุงูุงูู
            - ุถุฑุจ ุชุณุฑุน ุจุงุฒูุดุณุชฺฏ

            #### ฺฏุงู 2: ุชูุธู ุธุฑูุชโูุง (ุงุฎุชุงุฑ)
            - ุงุฒ ููู ฺฉูุงุฑ ูโุชูุงูุฏ ุธุฑูุช ูุฑ ุณูุช ุฑุง ุชุบุฑ ุฏูุฏ

            #### ฺฏุงู 3: ุชูุธู ุงุญุชูุงูุงุช ู ุฒูุงูโุจูุฏ (ุงุฎุชุงุฑ)
            - ุงุญุชูุงู ูุฑ ููุน ุงูุชูุงู ุฑุง ุชูุธู ฺฉูุฏ
            - ุชุนุฏุงุฏ ุณุงูโูุง ูุงุฒู ุจุฑุง ูุฑ ุงูุชูุงู ุฑุง ูุดุฎุต ฺฉูุฏ

            #### ฺฏุงู 4: ุงุฌุฑุง ุดุจูโุณุงุฒ
            - ุฑู ุฏฺฉูู "ุงุฌุฑุง ุดุจูโุณุงุฒ" ฺฉูฺฉ ฺฉูุฏ
            - ูุชุงุฌ ุจู ุตูุฑุช ูููุฏุงุฑ ู ุฌุฏูู ููุงุด ุฏุงุฏู ูโุดูุฏ

            ### โก ูฺฉุงุช ููู:
            - ูุชุงุฌ ุจุฑ ุงุณุงุณ ูุฏูโูุง ุฑุงุถ ู ุงุญุชูุงูุงุช ูุญุงุณุจู ูโุดูุฏ
            - ุชุบุฑ ูพุงุฑุงูุชุฑูุง ุชุฃุซุฑ ูุงุจู ุชูุฌู ุฑู ูุชุงุฌ ุฏุงุฑุฏ
            - ุงู ุงุจุฒุงุฑ ุจุฑุง ุจุฑูุงููโุฑุฒ ุงุณุชุฑุงุชฺฺฉ ููุงุจุน ุงูุณุงู ููุฏ ุงุณุช
            - ูุชุงุฌ ุจุงุฏ ุจู ุนููุงู ุฑุงูููุง ู ูู ูพุดโุจู ูุทุน ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดูุฏ
            """)

    def simulate_career_progression(self, years, probabilities, years_required, capacity, annual_hiring):
        """ุดุจูโุณุงุฒ ูพุดุฑูุช ุดุบู ุจุง ุฏุฑ ูุธุฑ ฺฏุฑ ุณุงูโูุง ููุฑุฏ ูุงุฒ"""
        results = {}

        # ูุถุนุช ุงููู ููุงุตุจ (ูุฑุถ ุจุฑ ุงุณุงุณ ุธุฑูุชโูุง)
        current_positions = {
            'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู4': 1570,
            'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู3': 2880,
            'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู2': 930,
            'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู1': 400,
            'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ': 540,
            'ูุนุงูู_ุดุนุจู': 1935,
            'ุจุงูฺฉุฏุงุฑ': 8625,
            'ูุนุงูู_ูุฏุฑ_ุดุนุจ': 105,
            'ูุฏุฑ_ุดุนุจ': 35,
            'ุณุงุฑ': 2000
        }

        # ุฑุฏุงุจ ุณุงุจูู ฺฉุงุฑ (ฺู ูุฏุช ุฏุฑ ูุฑ ุณูุช ุจูุฏูโุงูุฏ)
        position_tenure = {position: {} for position in current_positions.keys()}

        # ูุญุงุณุจู ุชุบุฑุงุช ุฏุฑ ุทูู ุณุงูโูุง ูุฎุชูู
        for year in range(1, years + 1):
            # ุดุจูโุณุงุฒ ุงุณุชุฎุฏุงู ุฌุฏุฏ
            new_hires = annual_hiring

            # ุดุจูโุณุงุฒ ุจุงุฒูุดุณุชฺฏ
            retirement_rate = min(year * 0.03, 0.12)  # ุชุฏุฑุฌ
            total_retirements = int(sum(current_positions.values()) * retirement_rate)

            # ุดุจูโุณุงุฒ ุงุฑุชูุงุก ุจุง ุฏุฑ ูุธุฑ ฺฏุฑ ุณุงูโูุง ููุฑุฏ ูุงุฒ
            promotions = self.calculate_promotions_with_tenure(
                probabilities, years_required, current_positions, position_tenure
            )

            # ุจูโุฑูุฒุฑุณุงู ุณุงุจูู ฺฉุงุฑ
            position_tenure = self.update_tenure(position_tenure, current_positions)

            # ุจูโุฑูุฒุฑุณุงู ุชุนุฏุงุฏ ุงูุฑุงุฏ ุฏุฑ ูุฑ ุณูุช
            current_positions = self.update_positions(
                current_positions, promotions, new_hires, total_retirements
            )

            # ุจุฑุฑุณ ุธุฑูุชโูุง ู ุชูุธู
            current_positions = self.adjust_for_capacity(current_positions, capacity)

            results[year] = {
                'ุงุณุชุฎุฏุงู_ุฌุฏุฏ': new_hires,
                'ุจุงุฒูุดุณุชฺฏ': total_retirements,
                'ุงุฑุชูุงุกูุง': promotions,
                'ูุถุนุช_ููุงุตุจ': current_positions.copy(),
                'ุธุฑูุช_ุงุณุชูุงุฏู': self.calculate_capacity_usage(current_positions, capacity)
            }

        return results

    def update_tenure(self, position_tenure, current_positions):
        """ุจูโุฑูุฒุฑุณุงู ุณุงุจูู ฺฉุงุฑ"""
        new_tenure = {}

        for position in current_positions.keys():
            new_tenure[position] = {}
            # ูุฑ ุณุงู ฺฉ ุณุงู ุจู ุณุงุจูู ููู ุงุถุงูู ูโุดูุฏ
            for tenure_years in range(1, 11):  # ุญุฏุงฺฉุซุฑ 10 ุณุงู ุฑุฏุงุจ
                if tenure_years == 1:
                    # ุฌุฏุฏ ูุงุฑุฏ ุดุฏูโูุง
                    new_tenure[position][tenure_years] = current_positions[position] // 10
                else:
                    # ุณุงุจููโุฏุงุฑุงู
                    prev_count = position_tenure.get(position, {}).get(tenure_years - 1, 0)
                    new_tenure[position][tenure_years] = prev_count

        return new_tenure

    def calculate_promotions_with_tenure(self, probabilities, years_required, current_positions, position_tenure):
        """ูุญุงุณุจู ุชุนุฏุงุฏ ุงุฑุชูุงุกูุง ูุฎุชูู ุจุง ุฏุฑ ูุธุฑ ฺฏุฑ ุณุงูโูุง ููุฑุฏ ูุงุฒ"""
        promotions = {}

        # ูุญุงุณุจู ุงุฑุชูุงุกูุง ุจุฑ ุงุณุงุณ ุชุนุฏุงุฏ ูุนูุ ุงุญุชูุงูุงุช ู ุณุงุจูู
        for transition, prob in probabilities.items():
            if 'retire' not in transition:
                required_years = years_required.get(transition, 3)

                # ูพุฏุง ฺฉุฑุฏู ฺฉุณุงู ฺฉู ูุงุฌุฏ ุดุฑุงุท ุณุงุจูู ฺฉุงุฑ ูุณุชูุฏ
                source_position = transition.split('_to_')[0].replace('ุจุงูฺฉุฏุงุฑ', 'ุจุงูฺฉุฏุงุฑ')

                if source_position in current_positions:
                    # ฺฉุณุงู ฺฉู ุณุงุจูู ฺฉุงู ุฏุงุฑูุฏ
                    eligible_count = 0
                    for tenure_years, count in position_tenure.get(source_position, {}).items():
                        if tenure_years >= required_years:
                            eligible_count += count

                    # ุงฺฏุฑ ุงุทูุงุนุงุช ุฏูู ุณุงุจูู ูุฏุงุดุชู ุจุงุดูุ ูุฑุถ ฺฉูู ูู ูุงุฌุฏ ุดุฑุงุท ูุณุชูุฏ
                    if eligible_count == 0:
                        eligible_count = current_positions[source_position] // 2

                    # ูุญุงุณุจู ุชุนุฏุงุฏ ุงุฑุชูุง
                    promotion_count = int(eligible_count * prob * 0.1)  # ุถุฑุจ ุชุนุฏู
                    promotions[transition] = promotion_count

        return promotions

    def adjust_for_capacity(self, current_positions, capacity):
        """ุชูุธู ุชุนุฏุงุฏ ฺฉุงุฑฺฉูุงู ุจุฑ ุงุณุงุณ ุธุฑูุชโูุง"""
        adjusted_positions = current_positions.copy()

        # ุชูุธู ุจุฑ ุงุณุงุณ ุธุฑูุชโูุง ุชุนุฑู ุดุฏู
        # (ุงู ูุณูุช ูโุชูุงูุฏ ูพฺุฏูโุชุฑ ุดูุฏ ุจุณุชู ุจู ูุงุฒ)

        return adjusted_positions

    def calculate_capacity_usage(self, current_positions, capacity):
        """ูุญุงุณุจู ุฏุฑุตุฏ ุงุณุชูุงุฏู ุงุฒ ุธุฑูุช"""
        usage = {}

        # ูุญุงุณุจู ุณุงุฏู ุฏุฑุตุฏ ุงุณุชูุงุฏู
        for position, count in current_positions.items():
            if position in ['ูุนุงูู_ูุฏุฑ_ุดุนุจ', 'ูุฏุฑ_ุดุนุจ']:
                max_capacity = capacity.get(position, 100)
                usage[position] = min(100, (count / max_capacity) * 100)
            else:
                usage[position] = 85  # ูุฑุถ ุจุฑุง ููุงุตุจ ุฏฺฏุฑ

        return usage

    def calculate_promotions(self, probabilities, current_positions):
        """ูุญุงุณุจู ุชุนุฏุงุฏ ุงุฑุชูุงุกูุง ูุฎุชูู (ูุชุฏ ุงุตู)"""
        promotions = {}

        # ูุญุงุณุจู ุงุฑุชูุงุกูุง ุจุฑ ุงุณุงุณ ุชุนุฏุงุฏ ูุนู ู ุงุญุชูุงูุงุช
        promotions['ุจุงูฺฉุฏุงุฑ_ุจู_ุฑุฆุณ_ุฏุงุฑู'] = int(
            current_positions['ุจุงูฺฉุฏุงุฑ'] * 0.1 * probabilities.get('ุจุงูฺฉุฏุงุฑ_to_ุฑุฆุณ_ุฏุงุฑู4', 0.6)
        )

        promotions['ุฑุฆุณ_ุฏุงุฑู_ุจู_ูุนุงูู'] = int(
            200 * probabilities.get('ุฑุฆุณ_ุฏุงุฑู4_to_ูุนุงูู_ุดุนุจู4', 0.3)
        )

        promotions['ูุนุงูู_ุดุนุจู4_ุจู_ุฑุฆุณ_ุดุนุจู4'] = int(
            current_positions['ูุนุงูู_ุดุนุจู'] * 0.2 * probabilities.get('ูุนุงูู_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู4', 0.5)
        )

        promotions['ุฑุฆุณ_ุดุนุจู4_ุจู_ุฑุฆุณ_ุดุนุจู3'] = int(
            current_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู4'] * 0.33 * probabilities.get('ุฑุฆุณ_ุดุนุจู4_to_ุฑุฆุณ_ุดุนุจู3', 0.5)
        )

        promotions['ุฑุฆุณ_ุดุนุจู3_ุจู_ุฑุฆุณ_ุดุนุจู2'] = int(
            current_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู3'] * 0.33 * probabilities.get('ุฑุฆุณ_ุดุนุจู3_to_ุฑุฆุณ_ุดุนุจู2', 0.4)
        )

        promotions['ุฑุฆุณ_ุดุนุจู2_ุจู_ุฑุฆุณ_ุดุนุจู1'] = int(
            current_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู2'] * 0.33 * probabilities.get('ุฑุฆุณ_ุดุนุจู2_to_ุฑุฆุณ_ุดุนุจู1', 0.4)
        )

        promotions['ุฑุฆุณ_ุดุนุจู1_ุจู_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ'] = int(
            current_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู1'] * 0.33 * probabilities.get('ุฑุฆุณ_ุดุนุจู1_to_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ', 0.5)
        )

        promotions['ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_ุจู_ูุนุงูู_ูุฏุฑ'] = int(
            current_positions['ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ'] * 0.33 * probabilities.get('ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_to_ูุนุงูู_ูุฏุฑ', 0.2)
        )

        promotions['ูุนุงูู_ูุฏุฑ_ุจู_ูุฏุฑ'] = int(
            current_positions['ูุนุงูู_ูุฏุฑ_ุดุนุจ'] * 0.33 * probabilities.get('ูุนุงูู_ูุฏุฑ_to_ูุฏุฑ_ุดุนุจ', 0.3)
        )

        return promotions

    def update_positions(self, current_positions, promotions, new_hires, retirements):
        """ุจูโุฑูุฒุฑุณุงู ุชุนุฏุงุฏ ุงูุฑุงุฏ ุฏุฑ ูุฑ ุณูุช"""
        new_positions = current_positions.copy()

        # ุงุถุงูู ฺฉุฑุฏู ุงูุฑุงุฏ ุฌุฏุฏ (ุนูุฏุชุงู ุจุงูฺฉุฏุงุฑ)
        new_positions['ุจุงูฺฉุฏุงุฑ'] += new_hires

        # ฺฉู ฺฉุฑุฏู ุจุงุฒูุดุณุชูโูุง (ุชูุงุณุจ ุงุฒ ููู ุณูุชโูุง)
        total_current = sum(current_positions.values())
        for position in new_positions:
            retirement_from_position = int(retirements * (current_positions[position] / total_current))
            new_positions[position] = max(0, new_positions[position] - retirement_from_position)

        # ุงุนูุงู ุงุฑุชูุงุกูุง
        # ฺฉู ฺฉุฑุฏู ุงุฒ ุณูุชโูุง ูพุงูโุชุฑ
        new_positions['ุจุงูฺฉุฏุงุฑ'] -= promotions.get('ุจุงูฺฉุฏุงุฑ_ุจู_ุฑุฆุณ_ุฏุงุฑู', 0)
        new_positions['ูุนุงูู_ุดุนุจู'] -= promotions.get('ูุนุงูู_ุดุนุจู4_ุจู_ุฑุฆุณ_ุดุนุจู4', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู4'] -= promotions.get('ุฑุฆุณ_ุดุนุจู4_ุจู_ุฑุฆุณ_ุดุนุจู3', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู3'] -= promotions.get('ุฑุฆุณ_ุดุนุจู3_ุจู_ุฑุฆุณ_ุดุนุจู2', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู2'] -= promotions.get('ุฑุฆุณ_ุดุนุจู2_ุจู_ุฑุฆุณ_ุดุนุจู1', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู1'] -= promotions.get('ุฑุฆุณ_ุดุนุจู1_ุจู_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ'] -= promotions.get('ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_ุจู_ูุนุงูู_ูุฏุฑ', 0)
        new_positions['ูุนุงูู_ูุฏุฑ_ุดุนุจ'] -= promotions.get('ูุนุงูู_ูุฏุฑ_ุจู_ูุฏุฑ', 0)

        # ุงุถุงูู ฺฉุฑุฏู ุจู ุณูุชโูุง ุจุงูุงุชุฑ
        new_positions['ูุนุงูู_ุดุนุจู'] += promotions.get('ุฑุฆุณ_ุฏุงุฑู_ุจู_ูุนุงูู', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู4'] += promotions.get('ูุนุงูู_ุดุนุจู4_ุจู_ุฑุฆุณ_ุดุนุจู4', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู3'] += promotions.get('ุฑุฆุณ_ุดุนุจู4_ุจู_ุฑุฆุณ_ุดุนุจู3', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู2'] += promotions.get('ุฑุฆุณ_ุดุนุจู3_ุจู_ุฑุฆุณ_ุดุนุจู2', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู1'] += promotions.get('ุฑุฆุณ_ุดุนุจู2_ุจู_ุฑุฆุณ_ุดุนุจู1', 0)
        new_positions['ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ'] += promotions.get('ุฑุฆุณ_ุดุนุจู1_ุจู_ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ', 0)
        new_positions['ูุนุงูู_ูุฏุฑ_ุดุนุจ'] += promotions.get('ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ_ุจู_ูุนุงูู_ูุฏุฑ', 0)
        new_positions['ูุฏุฑ_ุดุนุจ'] += promotions.get('ูุนุงูู_ูุฏุฑ_ุจู_ูุฏุฑ', 0)

        # ุงุทููุงู ุงุฒ ูุซุจุช ุจูุฏู ุชูุงู ููุงุฏุฑ
        for position in new_positions:
            new_positions[position] = max(0, new_positions[position])

        return new_positions

    def create_visualizations(self, simulation_results):
        """ุงุฌุงุฏ ุชุฌุณูโูุง ูุฎุชูู"""

        # ูููุฏุงุฑ ุชุบุฑุงุช ฺฉู ูพุฑุณูู
        years = list(simulation_results.keys())
        total_staff = []
        new_hires = []
        retirements = []

        for year in years:
            new_hires.append(simulation_results[year]['ุงุณุชุฎุฏุงู_ุฌุฏุฏ'])
            retirements.append(simulation_results[year]['ุจุงุฒูุดุณุชฺฏ'])
            total_current = sum(simulation_results[year]['ูุถุนุช_ููุงุตุจ'].values())
            total_staff.append(total_current)

        # ูููุฏุงุฑ ุฎุท ุชุบุฑุงุช ูพุฑุณูู
        fig1 = go.Figure()
        fig1.add_trace(go.Scatter(x=years, y=total_staff, name='ฺฉู ูพุฑุณูู', line=dict(color='blue', width=3)))
        fig1.add_trace(go.Bar(x=years, y=new_hires, name='ุงุณุชุฎุฏุงู ุฌุฏุฏ', marker_color='green'))
        fig1.add_trace(go.Bar(x=years, y=[-x for x in retirements], name='ุจุงุฒูุดุณุชฺฏ', marker_color='red'))

        fig1.update_layout(
            title='ูพุดโุจู ุชุบุฑุงุช ูพุฑุณูู ุจุงูฺฉ',
            xaxis_title='ุณุงู',
            yaxis_title='ุชุนุฏุงุฏ ููุฑ',
            hovermode='x unified'
        )

        # ูููุฏุงุฑ ุฏุงุฑูโุง ุชูุฒุน ููุงุตุจ ูุนู (ูุฑุถ)
        positions = ['ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 4', 'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 3', 'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 2',
                     'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 1', 'ุฑุฆุณ ุดุนุจู ููุชุงุฒ', 'ูุนุงููู', 'ุจุงูฺฉุฏุงุฑุงู', 'ุณุงุฑ']
        initial_values = [1570, 2880, 930, 400, 540, 1935, 8625, 2000]  # ูุฑุถ

        fig2 = px.pie(values=initial_values, names=positions, title='ุชูุฒุน ูุนู ููุงุตุจ (ุงุจุชุฏุง ุดุจูโุณุงุฒ)')

        # ูููุฏุงุฑ ุฏุงุฑูโุง ุชูุฒุน ููุงุตุจ ุฏุฑ ุงูุชูุง ุดุจูโุณุงุฒ
        final_year = max(years)
        final_positions = simulation_results[final_year]['ูุถุนุช_ููุงุตุจ']

        # ุชุจุฏู ูุงูโูุง ฺฉูุฏูุง ุจู ูุงุฑุณ ุจุฑุง ููุงุด
        persian_position_names = {
            'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู4': 'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 4',
            'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู3': 'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 3',
            'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู2': 'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 2',
            'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู1': 'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 1',
            'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ': 'ุฑุฆุณ ุดุนุจู ููุชุงุฒ',
            'ูุนุงูู_ุดุนุจู': 'ูุนุงููู ุดุนุจู',
            'ุจุงูฺฉุฏุงุฑ': 'ุจุงูฺฉุฏุงุฑุงู',
            'ูุนุงูู_ูุฏุฑ_ุดุนุจ': 'ูุนุงูู ูุฏุฑ ุดุนุจ',
            'ูุฏุฑ_ุดุนุจ': 'ูุฏุฑ ุดุนุจ',
            'ุณุงุฑ': 'ุณุงุฑ ููุงุตุจ'
        }

        final_position_names = [persian_position_names.get(k, k) for k in final_positions.keys()]
        final_values = list(final_positions.values())

        fig3 = px.pie(values=final_values, names=final_position_names,
                      title=f'ุชูุฒุน ูพุดโุจู ุดุฏู ููุงุตุจ (ุณุงู {final_year})')

        # ูููุฏุงุฑ ููุงุณูโุง ุชุบุฑุงุช ููุงุตุจ ููู
        key_positions = ['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู4', 'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู3', 'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู2',
                         'ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู1', 'ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ', 'ูุนุงูู_ูุฏุฑ_ุดุนุจ', 'ูุฏุฑ_ุดุนุจ']

        fig4 = go.Figure()

        for position in key_positions:
            position_data = [simulation_results[year]['ูุถุนุช_ููุงุตุจ'][position] for year in years]
            persian_name = persian_position_names.get(position, position)
            fig4.add_trace(go.Scatter(x=years, y=position_data, name=persian_name, mode='lines+markers'))

        fig4.update_layout(
            title='ุฑููุฏ ุชุบุฑุงุช ููุงุตุจ ูุฏุฑุช ฺฉูุฏ',
            xaxis_title='ุณุงู',
            yaxis_title='ุชุนุฏุงุฏ ููุฑ',
            hovermode='x unified'
        )

        # ูููุฏุงุฑ ุฌุฏุฏ: ุฏุฑุตุฏ ุงุณุชูุงุฏู ุงุฒ ุธุฑูุช
        fig5 = go.Figure()

        capacity_usage_data = {}
        for year in years:
            capacity_data = simulation_results[year].get('ุธุฑูุช_ุงุณุชูุงุฏู', {})
            for position, usage in capacity_data.items():
                if position not in capacity_usage_data:
                    capacity_usage_data[position] = []
                capacity_usage_data[position].append(usage)

        for position, usage_list in capacity_usage_data.items():
            persian_name = persian_position_names.get(position, position)
            fig5.add_trace(go.Scatter(x=years, y=usage_list, name=persian_name, mode='lines+markers'))

        fig5.update_layout(
            title='ุฏุฑุตุฏ ุงุณุชูุงุฏู ุงุฒ ุธุฑูุช ููุงุตุจ',
            xaxis_title='ุณุงู',
            yaxis_title='ุฏุฑุตุฏ ุงุณุชูุงุฏู',
            yaxis=dict(range=[0, 120])
        )

        return fig1, fig2, fig3, fig4, fig5


def main():
    st.title("๐๏ธ ุดุจูโุณุงุฒ ุฌุงูุดูโูพุฑูุฑ ุจุงูฺฉ")
    st.markdown("---")

    simulator = BankSuccessionSimulator()

    # ููุงุด ุชูุถุญุงุช ฺฉุงูู
    simulator.create_simulation_explanation()

    st.markdown("---")

    # ุชูุธูุงุช ุงุตู
    st.header("๐๏ธ ุชูุธูุงุช ุงุตู ุดุจูโุณุงุฒ")
    col1, col2, col3 = st.columns(3)

    with col1:
        simulation_years = st.slider("ุชุนุฏุงุฏ ุณุงูโูุง ุดุจูโุณุงุฒ", 1, 20, 10)

    with col2:
        annual_hiring = st.number_input("ุชุนุฏุงุฏ ุงุณุชุฎุฏุงู ุณุงูุงูู", 100, 1000, 500)

    with col3:
        retirement_acceleration = st.slider("ุถุฑุจ ุชุณุฑุน ุจุงุฒูุดุณุชฺฏ", 0.5, 2.0, 1.0)

    # ุชูุธูุงุช ุชูุตู ุฏุฑ sidebar
    capacity = simulator.create_capacity_settings()
    probabilities, years_required = simulator.create_probability_sliders()

    # ุฏฺฉูู ุงุฌุฑุง ุดุจูโุณุงุฒ
    st.markdown("---")
    if st.button("๐ ุงุฌุฑุง ุดุจูโุณุงุฒ", type="primary"):
        with st.spinner("ุฏุฑ ุญุงู ุงูุฌุงู ุดุจูโุณุงุฒ..."):
            # ุงุฌุฑุง ุดุจูโุณุงุฒ
            results = simulator.simulate_career_progression(
                simulation_years, probabilities, years_required, capacity, annual_hiring
            )

            # ููุงุด ูุชุงุฌ
            st.success("ุดุจูโุณุงุฒ ุจุง ููููุช ุงูุฌุงู ุดุฏ!")

            # ุงุฌุงุฏ ูููุฏุงุฑูุง
            fig1, fig2, fig3, fig4, fig5 = simulator.create_visualizations(results)

            # ููุงุด ูููุฏุงุฑูุง
            st.header("๐ ูุชุงุฌ ุดุจูโุณุงุฒ")

            # ูููุฏุงุฑ ุชุบุฑุงุช ฺฉู ูพุฑุณูู
            st.plotly_chart(fig1, use_container_width=True)

            # ูููุฏุงุฑูุง ููุงุณูโุง ุชูุฒุน ููุงุตุจ
            st.subheader("๐ ููุงุณู ุชูุฒุน ููุงุตุจ")
            col1, col2 = st.columns(2)

            with col1:
                st.plotly_chart(fig2, use_container_width=True)

            with col2:
                st.plotly_chart(fig3, use_container_width=True)

            # ูููุฏุงุฑ ุฑููุฏ ุชุบุฑุงุช ููุงุตุจ ูุฏุฑุช
            st.plotly_chart(fig4, use_container_width=True)

            # ูููุฏุงุฑ ุฏุฑุตุฏ ุงุณุชูุงุฏู ุงุฒ ุธุฑูุช
            st.plotly_chart(fig5, use_container_width=True)

            # ููุงุด ุฌุฏูู ูุชุงุฌ ุชูุตู
            st.subheader("๐ ูุชุงุฌ ุชูุตู ุดุจูโุณุงุฒ")

            # ุชุจุฏู ูุชุงุฌ ุจู DataFrame ุจุฑุง ููุงุด
            summary_data = []
            for year, data in results.items():
                summary_data.append({
                    'ุณุงู': year,
                    'ุงุณุชุฎุฏุงู ุฌุฏุฏ': data['ุงุณุชุฎุฏุงู_ุฌุฏุฏ'],
                    'ุจุงุฒูุดุณุชฺฏ': data['ุจุงุฒูุดุณุชฺฏ'],
                    'ฺฉู ูพุฑุณูู': sum(data['ูุถุนุช_ููุงุตุจ'].values()),
                    'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 4': data['ูุถุนุช_ููุงุตุจ']['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู4'],
                    'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 3': data['ูุถุนุช_ููุงุตุจ']['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู3'],
                    'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 2': data['ูุถุนุช_ููุงุตุจ']['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู2'],
                    'ุฑุฆุณ ุดุนุจู ุฏุฑุฌู 1': data['ูุถุนุช_ููุงุตุจ']['ุฑุฆุณ_ุดุนุจู_ุฏุฑุฌู1'],
                    'ุฑุฆุณ ุดุนุจู ููุชุงุฒ': data['ูุถุนุช_ููุงุตุจ']['ุฑุฆุณ_ุดุนุจู_ููุชุงุฒ'],
                    'ูุนุงูู ูุฏุฑ ุดุนุจ': data['ูุถุนุช_ููุงุตุจ']['ูุนุงูู_ูุฏุฑ_ุดุนุจ'],
                    'ูุฏุฑ ุดุนุจ': data['ูุถุนุช_ููุงุตุจ']['ูุฏุฑ_ุดุนุจ']
                })

            df_summary = pd.DataFrame(summary_data)
            st.dataframe(df_summary, use_container_width=True)

            # ูุดุฏุงุฑูุง ููู
            st.subheader("โ๏ธ ุชุญูู ู ูุดุฏุงุฑูุง ููู")

            # ูุญุงุณุจู ุขูุงุฑ ฺฉู
            final_year_data = results[simulation_years]
            total_retirement = sum([results[year]['ุจุงุฒูุดุณุชฺฏ'] for year in results])
            total_hiring = sum([results[year]['ุงุณุชุฎุฏุงู_ุฌุฏุฏ'] for year in results])
            net_change = total_hiring - total_retirement

            col1, col2, col3, col4 = st.columns(4)

            with col1:
                st.metric("ฺฉู ุงุณุชุฎุฏุงู", total_hiring)

            with col2:
                st.metric("ฺฉู ุจุงุฒูุดุณุชฺฏ", total_retirement)

            with col3:
                st.metric("ุชุบุฑ ุฎุงูุต", net_change)

            with col4:
                final_total = sum(final_year_data['ูุถุนุช_ููุงุตุจ'].values())
                st.metric("ฺฉู ูพุฑุณูู ููุง", final_total)

            # ูุดุฏุงุฑูุง
            if net_change < 0:
                st.error(f"๐จ ฺฉูุจูุฏ ูุฑู ุงูุณุงู: {abs(net_change)} ููุฑ ฺฉูุชุฑ ุงุฒ ูุงุฒ")
            elif net_change > total_hiring * 0.5:
                st.warning(f"โ๏ธ ุฑุดุฏ ุฒุงุฏ ูุฑู ุงูุณุงู: {net_change} ููุฑ ุงุถุงูู")
            else:
                st.success(f"โ ุชุนุงุฏู ููุงุณุจ ูุฑู ุงูุณุงู: {net_change} ููุฑ ุชุบุฑ ุฎุงูุต")

            # ุจุฑุฑุณ ูุฑุฎ ุงุฑุชูุง
            total_promotions = sum([sum(results[year]['ุงุฑุชูุงุกูุง'].values()) for year in results])
            promotion_rate = total_promotions / (
                        total_hiring + sum([sum(data['ูุถุนุช_ููุงุตุจ'].values()) for data in results.values()]) / len(
                    results))

            if promotion_rate < 0.05:
                st.warning("โ๏ธ ูุฑุฎ ุงุฑุชูุง ูพุงู ุงุณุช - ููฺฉู ุงุณุช ููุฌุจ ูุงุฑุถุงุช ฺฉุงุฑฺฉูุงู ุดูุฏ")
            elif promotion_rate > 0.2:
                st.warning("โ๏ธ ูุฑุฎ ุงุฑุชูุง ุจุงูุง ุงุณุช - ุจุฑุฑุณ ฺฉูุช ุงุฑุชูุงุกูุง ุถุฑูุฑ ุงุณุช")

            # ูพุดููุงุฏุงุช
            st.subheader("๐ก ูพุดููุงุฏุงุช ุจูุจูุฏ")
            suggestions = []

            if net_change < 0:
                suggestions.append("๐น ุงูุฒุงุด ูุฑุฎ ุงุณุชุฎุฏุงู ุฏุฑ ุณูุชโูุง ฺฉูุฏ")
                suggestions.append("๐น ฺฉุงูุด ูุฑุฎ ุจุงุฒูุดุณุชฺฏ ุงุฒ ุทุฑู ูุดููโูุง ุญูุธ ูุฑู")

            if promotion_rate < 0.05:
                suggestions.append("๐น ุชุณุฑุน ุจุฑูุงููโูุง ุขููุฒุด ู ุชูุณุนู ุดุบู")
                suggestions.append("๐น ุงุฌุงุฏ ูุณุฑูุง ุงุฑุชูุง ุฌุงฺฏุฒู")

            suggestions.extend([
                "๐น ุงุฌุงุฏ ุจุฑูุงููโูุง ุฌุงูุดูโูพุฑูุฑ ูุฏูููุฏ",
                "๐น ุชูุณุนู ุจุฑูุงููโูุง ุญูุธ ุงุณุชุนุฏุงุฏ",
                "๐น ุจุงุฒูฺฏุฑ ุฏูุฑูโุง ุฏุฑ ุณุงุณุชโูุง ููุงุจุน ุงูุณุงู",
                "๐น ุงุฌุงุฏ ุณุณุชู ูพุดโุจู ุฏููโุชุฑ ูุงุฒูุง ุขุช"
            ])

            for suggestion in suggestions:
                st.write(suggestion)

            # ุงูฺฉุงู ุฏุงูููุฏ ูุชุงุฌ
            st.subheader("๐พ ุฏุงูููุฏ ูุชุงุฌ")
            csv = df_summary.to_csv(index=False).encode('utf-8')
            st.download_button(
                label="ุฏุงูููุฏ ูุชุงุฌ ุจู ุตูุฑุช CSV",
                data=csv,
                file_name=f'simulation_results_{simulation_years}years.csv',
                mime='text/csv'
            )

    # ุงุทูุงุนุงุช ุงุถุงู ุฏุฑ ูพุงุงู ุตูุญู
    st.markdown("---")
    with st.expander("โน๏ธ ุงุทูุงุนุงุช ุจุดุชุฑ ู ูุญุฏูุฏุชโูุง"):
        st.markdown("""
        ### ูฺฉุงุช ููู:
        - ุงู ุดุจูโุณุงุฒ ุจุฑ ุงุณุงุณ ูุฏูโูุง ุงุญุชูุงูุงุช ฺฉุงุฑ ูโฺฉูุฏ
        - ูุชุงุฌ ุจุงุฏ ุจู ุนููุงู ุฑุงูููุง ุงุณุชูุงุฏู ุดูุฏ ูู ูพุดโุจู ูุทุน  
        - ูพุงุฑุงูุชุฑูุง ูุฎุชูู ุชุฃุซุฑ ูุงุจู ุชูุฌู ุฑู ูุชุงุฌ ุฏุงุฑูุฏ
        - ุจุฑุง ุฏูุช ุจุดุชุฑุ ุฏุงุฏูโูุง ูุงูุน ุณุงุฒูุงู ุฑุง ุงุณุชูุงุฏู ฺฉูุฏ

        ### ฺฉุงุฑุจุฑุฏูุง ุงู ุงุจุฒุงุฑ:
        - ุจุฑูุงููโุฑุฒ ุงุณุชุฑุงุชฺฺฉ ููุงุจุน ุงูุณุงู
        - ุชุญูู ุชุฃุซุฑ ุณุงุณุชโูุง ูุฎุชูู HR  
        - ุดูุงุณุง ฺฉูุจูุฏูุง ู ูุงุฒุงุฏูุง ุขุช
        - ุจุฑูุงููโุฑุฒ ุฌุงูุดูโูพุฑูุฑ
        """)


if __name__ == "__main__":
    main()